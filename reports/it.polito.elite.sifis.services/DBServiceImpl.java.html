<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DBServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sifis</a> &gt; <a href="index.source.html" class="el_package">it.polito.elite.sifis.services</a> &gt; <span class="el_source">DBServiceImpl.java</span></div><h1>DBServiceImpl.java</h1><pre class="source lang-java linenums">package it.polito.elite.sifis.services;

import java.util.Collection;
import java.util.Comparator;
import java.util.HashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Set;

import org.semanticweb.owlapi.model.OWLOntologyCreationException;
import org.springframework.beans.factory.annotation.Autowired;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;

import it.polito.elite.sifis.entities.db.Dbaction;
import it.polito.elite.sifis.entities.db.Dbdetail;
import it.polito.elite.sifis.entities.db.Dbentity;
import it.polito.elite.sifis.entities.db.Dbrule;
import it.polito.elite.sifis.entities.db.Dbtrigger;
import it.polito.elite.sifis.entities.db.User;
import it.polito.elite.sifis.entities.owl.Action;
import it.polito.elite.sifis.entities.owl.Detail;
import it.polito.elite.sifis.entities.owl.IoTEntity;
import it.polito.elite.sifis.entities.owl.Location;
import it.polito.elite.sifis.entities.owl.Rule;
import it.polito.elite.sifis.entities.owl.Service;
import it.polito.elite.sifis.entities.owl.Trigger;
import it.polito.elite.sifis.repositories.ActionRepository;
import it.polito.elite.sifis.repositories.DetailRepository;
import it.polito.elite.sifis.repositories.EntityRepository;
import it.polito.elite.sifis.repositories.RuleRepository;
import it.polito.elite.sifis.repositories.TriggerRepository;

<span class="fc" id="L35">public class DBServiceImpl implements DBService {</span>

	@Autowired
	UserService userService;
	@Autowired
	EntityRepository entityRepository;
	@Autowired
	RuleRepository ruleRepository;
	@Autowired
	TriggerRepository triggerRepository;
	@Autowired
	ActionRepository actionRepository;
	@Autowired
	DetailRepository detailRepository;
	@Autowired
	OWLService owlService;
	
	
	@Override
	public Dbentity saveEntity(Dbentity entity) {
<span class="nc" id="L55">		return entityRepository.save(entity);</span>
	}

	@Override
	public Dbrule saveRule(Rule rule, String type, String username) throws OWLOntologyCreationException {
<span class="fc" id="L60">		Dbrule r = new Dbrule();</span>
<span class="fc" id="L61">		r.setTimestamp(rule.getTimestamp());</span>
<span class="fc" id="L62">		r.setType(type);</span>
<span class="fc" id="L63">		r.setEffect(rule.getEffect());</span>
<span class="fc" id="L64">		r.setSubject(rule.getSubject());</span>
<span class="fc" id="L65">		User u = userService.findUserByUsername(username);</span>
<span class="fc" id="L66">		User ruleUser = new User();</span>
<span class="fc" id="L67">		ruleUser.setId(u.getId());</span>
<span class="fc" id="L68">		r.setUser(ruleUser);</span>
<span class="fc" id="L69">		List&lt;Dbtrigger&gt; ts = new LinkedList&lt;Dbtrigger&gt;();</span>
<span class="fc" id="L70">		List&lt;Dbaction&gt; as = new LinkedList&lt;Dbaction&gt;();</span>
<span class="fc" id="L71">		Dbtrigger t = new Dbtrigger();</span>
<span class="fc" id="L72">		t.setUrl(rule.getTrigger().getURL());</span>
		
<span class="fc" id="L74">		List&lt;Dbdetail&gt; tds = new LinkedList&lt;Dbdetail&gt;();</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">		for(Detail detail : rule.getTrigger().getDetails()){</span>
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">			if(detail.getType().equals(&quot;entity&quot;)){</span>
<span class="nc" id="L77">				ObjectMapper mapper = new ObjectMapper();</span>
<span class="nc" id="L78">				IoTEntity entity = mapper.convertValue(detail.getValue(), IoTEntity.class);</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">				if(entity != null){</span>
<span class="nc" id="L80">					Dbentity dbentity = entityRepository.findByUrl(entity.getURL());</span>
<span class="nc" id="L81">					Dbentity e = new Dbentity();</span>
<span class="nc" id="L82">					e.setId(dbentity.getId());</span>
<span class="nc" id="L83">					t.setEntity(e);</span>
				}
<span class="nc" id="L85">			}</span>
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">			else if(detail.getType().equals(&quot;location&quot;)) {</span>
<span class="nc" id="L87">				ObjectMapper mapper = new ObjectMapper();</span>
<span class="nc" id="L88">				Location location = mapper.convertValue(detail.getValue(), Location.class);</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">				if(location != null) {</span>
<span class="nc" id="L90">					Dbdetail d = new Dbdetail();</span>
<span class="nc" id="L91">					d.setTrigger(t);</span>
<span class="nc" id="L92">					d.setType(detail.getType());</span>
<span class="nc" id="L93">					d.setUrl(detail.getURL());</span>
<span class="nc" id="L94">					d.setValue(location.getName());</span>
<span class="nc" id="L95">					d.setValueURL(location.getURL());</span>
<span class="nc" id="L96">					tds.add(d);</span>
				}
<span class="nc" id="L98">			}</span>
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">			else if(detail.getValue()!= null){</span>
<span class="fc" id="L100">				Dbdetail d = new Dbdetail();</span>
<span class="fc" id="L101">				d.setTrigger(t);</span>
<span class="fc" id="L102">				d.setType(detail.getType());</span>
<span class="fc" id="L103">				d.setUrl(detail.getURL());</span>
<span class="fc" id="L104">				d.setValue(detail.getValue().toString());</span>
<span class="fc" id="L105">				tds.add(d);</span>
			}
<span class="fc" id="L107">		}</span>
<span class="fc" id="L108">		t.setDetails(tds);</span>
		
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">		if(t.getEntity() == null){</span>
<span class="fc" id="L111">			Collection&lt;IoTEntity&gt; entities = owlService.getIoTEntitiesByService(rule.getTrigger().getService().getId(), username);</span>
<span class="fc" id="L112">			Dbentity dbentity = null;</span>
<span class="pc" id="L113">			try{dbentity = entityRepository.findByUrl(entities.iterator().next().getURL());}catch(Throwable tr){};</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">			if(dbentity != null){</span>
<span class="nc" id="L115">				Dbentity e = new Dbentity();</span>
<span class="nc" id="L116">				e.setId(dbentity.getId());</span>
<span class="nc" id="L117">				t.setEntity(e);</span>
			}
		}
		
<span class="fc" id="L121">		Dbaction a = new Dbaction();</span>
<span class="fc" id="L122">		a.setUrl(rule.getAction().getURL());</span>
		
<span class="fc" id="L124">		List&lt;Dbdetail&gt; ads = new LinkedList&lt;Dbdetail&gt;();</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">		for(Detail detail : rule.getAction().getDetails()){</span>
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">			if(detail.getType().equals(&quot;entity&quot;)){</span>
<span class="nc" id="L127">				ObjectMapper mapper = new ObjectMapper();</span>
<span class="nc" id="L128">				IoTEntity entity = mapper.convertValue(detail.getValue(), IoTEntity.class);</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">				if(entity != null){</span>
<span class="nc" id="L130">					Dbentity dbentity = entityRepository.findByUrl(entity.getURL());</span>
<span class="nc" id="L131">					Dbentity e = new Dbentity();</span>
<span class="nc" id="L132">					e.setId(dbentity.getId());</span>
<span class="nc" id="L133">					a.setEntity(e);</span>
				}
<span class="nc" id="L135">			}</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">			else if(detail.getType().equals(&quot;location&quot;)) {</span>
<span class="fc" id="L137">				ObjectMapper mapper = new ObjectMapper();</span>
<span class="fc" id="L138">				Location location = mapper.convertValue(detail.getValue(), Location.class);</span>
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">				if(location != null) {</span>
<span class="fc" id="L140">					Dbdetail d = new Dbdetail();</span>
<span class="fc" id="L141">					d.setAction(a);</span>
<span class="fc" id="L142">					d.setType(detail.getType());</span>
<span class="fc" id="L143">					d.setUrl(detail.getURL());</span>
<span class="fc" id="L144">					d.setValue(location.getName());</span>
<span class="fc" id="L145">					d.setValueURL(location.getURL());</span>
<span class="fc" id="L146">					ads.add(d);</span>
				}
<span class="fc" id="L148">			}</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">			else if(detail.getValue()!= null){</span>
<span class="nc" id="L150">				Dbdetail d = new Dbdetail();</span>
<span class="nc" id="L151">				d.setType(detail.getType());</span>
<span class="nc" id="L152">				d.setUrl(detail.getURL());</span>
<span class="nc" id="L153">				d.setValue(detail.getValue().toString());</span>
<span class="nc" id="L154">				d.setAction(a);</span>
<span class="nc" id="L155">				ads.add(d);</span>
			}
<span class="fc" id="L157">		}</span>
<span class="fc" id="L158">		a.setDetails(ads);</span>
		
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">		if(a.getEntity() == null){</span>
<span class="fc" id="L161">			Collection&lt;IoTEntity&gt; entities = owlService.getIoTEntitiesByService(rule.getAction().getService().getId(), username);</span>
<span class="fc" id="L162">			Dbentity dbentity = null;</span>
<span class="pc" id="L163">			try{dbentity = entityRepository.findByUrl(entities.iterator().next().getURL());}catch(Throwable tr){};</span>
<span class="pc bpc" id="L164" title="1 of 2 branches missed.">			if(dbentity != null){</span>
<span class="nc" id="L165">				Dbentity e = new Dbentity();</span>
<span class="nc" id="L166">				e.setId(dbentity.getId());</span>
<span class="nc" id="L167">				a.setEntity(e);</span>
			}
		}
		
	
<span class="fc" id="L172">		t.setRule(r);</span>
<span class="fc" id="L173">		a.setRule(r);</span>
<span class="fc" id="L174">		ts.add(t);</span>
<span class="fc" id="L175">		as.add(a);</span>
<span class="fc" id="L176">		r.setActions(as);</span>
<span class="fc" id="L177">		r.setTriggers(ts);</span>
<span class="fc" id="L178">		return ruleRepository.save(r);</span>
	}


	@Override
	public List&lt;Rule&gt; getRulesByType(String type, String username) throws OWLOntologyCreationException, InterruptedException {
<span class="fc" id="L184">		List&lt;Rule&gt; rules = new LinkedList&lt;Rule&gt;();</span>
<span class="fc" id="L185">		User u = userService.findUserByUsername(username);</span>
<span class="fc" id="L186">		List&lt;Dbrule&gt; dbRules = ruleRepository.findByUserAndType(u,type);</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">		for(Dbrule dbRule : dbRules){</span>
<span class="fc" id="L188">			Rule rule = new Rule();</span>
<span class="fc" id="L189">			rule.setDbId(dbRule.getId());</span>
<span class="fc" id="L190">			rule.setEffect(dbRule.getEffect());</span>
<span class="fc" id="L191">			rule.setSubject(dbRule.getSubject());</span>
<span class="fc" id="L192">			Trigger trigger = new Trigger();</span>
<span class="fc" id="L193">			Action action = new Action();</span>
<span class="fc" id="L194">			Dbtrigger dbTrigger = dbRule.getTriggers().iterator().next();</span>
<span class="fc" id="L195">			Dbaction dbAction = dbRule.getActions().iterator().next();</span>
			
<span class="fc" id="L197">			trigger = owlService.getTrigger(dbTrigger.getUrl(), username);</span>
<span class="fc" id="L198">			action = owlService.getAction(dbAction.getUrl(), username);</span>
			//boolean entityDetail = false;
			try{
<span class="fc bfc" id="L201" title="All 2 branches covered.">				for(Detail d : trigger.getDetails()){</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">					if(d.getType().equals(&quot;entity&quot;)){</span>
						//entityDetail = true;
<span class="nc" id="L204">						d.setValue(owlService.getIoTEntityByUrl(dbTrigger.getEntity().getUrl(), username));</span>
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">					} else if(d.getType().equals(&quot;location&quot;)){</span>
<span class="nc" id="L206">						Location loc = new Location();</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">						for(Dbdetail db : dbTrigger.getDetails()){</span>
<span class="nc bnc" id="L208" title="All 8 branches missed.">							if(d.getURL() != null &amp;&amp; db.getUrl() != null &amp;&amp; d.getURL().equals(db.getUrl()) &amp;&amp; d.getType() != &quot;entitiy&quot;){</span>
<span class="nc" id="L209">								loc.setName(db.getValue());</span>
<span class="nc" id="L210">								loc.setURL(db.getValueURL());</span>
<span class="nc" id="L211">								d.setValue(loc);</span>
							}
<span class="nc" id="L213">						}						</span>
<span class="nc" id="L214">					} else {</span>
<span class="fc bfc" id="L215" title="All 2 branches covered.">						for(Dbdetail db : dbTrigger.getDetails()){</span>
<span class="pc bpc" id="L216" title="4 of 10 branches missed.">							if(d.getURL() != null &amp;&amp; db.getUrl() != null &amp;&amp; d.getURL().equals(db.getUrl()) &amp;&amp; d.getType() != &quot;entitiy&quot; &amp;&amp;  d.getType() != &quot;location&quot;){</span>
<span class="fc" id="L217">								d.setValue(db.getValue());</span>
							}
<span class="fc" id="L219">						}</span>
					}
					
<span class="fc" id="L222">				}</span>
				
<span class="fc" id="L224">				trigger.getDetails().sort(new Comparator&lt;Detail&gt;() {</span>
					@Override
					public int compare(Detail o1, Detail o2) {
<span class="fc" id="L227">						return o1.getName().compareTo(o2.getName());</span>
					}
					
				});
				/*if(!entityDetail){
					//create attribute to set the entity
					Detail detail = new Detail();
					detail.setName(&quot;Which entity?&quot;);
					detail.setType(&quot;entity&quot;);
					detail.setURL(&quot;entity_detail&quot;);
					detail.setValue(owlService.getIoTEntityByUrl(dbTrigger.getEntity().getUrl(), username));
					trigger.addDetail(detail);
				}*/
				
				//entityDetail = false;
<span class="fc bfc" id="L242" title="All 2 branches covered.">				for(Detail d : action.getDetails()){</span>
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">					if(d.getType().equals(&quot;entity&quot;)){</span>
						//entityDetail = true;
<span class="nc" id="L245">						d.setValue(owlService.getIoTEntityByUrl(dbAction.getEntity().getUrl(), username));</span>
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">					} else if(d.getType().equals(&quot;location&quot;)){</span>
<span class="fc" id="L247">						Location loc = new Location();</span>
<span class="fc bfc" id="L248" title="All 2 branches covered.">						for(Dbdetail db : dbAction.getDetails()){</span>
<span class="pc bpc" id="L249" title="4 of 8 branches missed.">							if(d.getURL() != null &amp;&amp; db.getUrl() != null &amp;&amp; d.getURL().equals(db.getUrl()) &amp;&amp; d.getType() != &quot;entitiy&quot;){</span>
<span class="fc" id="L250">								loc.setName(db.getValue());</span>
<span class="fc" id="L251">								loc.setURL(db.getValueURL());</span>
<span class="fc" id="L252">								d.setValue(loc);</span>
							}
<span class="fc" id="L254">						}						</span>
<span class="fc" id="L255">					} else {</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">						for(Dbdetail db : dbAction.getDetails()){</span>
<span class="nc bnc" id="L257" title="All 10 branches missed.">							if(d.getURL() != null &amp;&amp; db.getUrl() != null &amp;&amp; d.getURL().equals(db.getUrl()) &amp;&amp; d.getType() != &quot;entitiy&quot; &amp;&amp;  d.getType() != &quot;location&quot;){</span>
<span class="nc" id="L258">								d.setValue(db.getValue());</span>
							}
<span class="nc" id="L260">						}</span>
					}
<span class="fc" id="L262">				}</span>
<span class="fc" id="L263">				action.getDetails().sort(new Comparator&lt;Detail&gt;() {</span>
					@Override
					public int compare(Detail o1, Detail o2) {
<span class="nc" id="L266">						return o1.getName().compareTo(o2.getName());</span>
					}
					
				});
				/*if(!entityDetail){
					//create attribute to set the entity
					Detail detail = new Detail();
					detail.setName(&quot;Which entity?&quot;);
					detail.setType(&quot;entity&quot;);
					detail.setValue(owlService.getIoTEntityByUrl(dbAction.getEntity().getUrl(), username));
					action.addDetail(detail);
				}*/
<span class="pc" id="L278">			} catch(Throwable t) {}</span>
<span class="fc" id="L279">			rule.setAction(action);</span>
<span class="fc" id="L280">			rule.setTrigger(trigger);</span>
<span class="fc" id="L281">			rule.setType(dbRule.getType());</span>
<span class="fc" id="L282">			rule.setTimestamp(dbRule.getTimestamp());</span>

			
<span class="fc" id="L285">			rules.add(rule);</span>
			
<span class="fc" id="L287">		}</span>
<span class="fc" id="L288">		return rules;</span>
	}

	@Override
	public void deleteRule(Long ruleId) {
<span class="nc" id="L293">		Dbrule rule = ruleRepository.findById(ruleId).get();</span>
<span class="nc" id="L294">		ruleRepository.delete(rule);</span>
<span class="nc" id="L295">	}</span>
	
	@Override
	public void deleteAllRules(String username) throws OWLOntologyCreationException, InterruptedException {
<span class="nc" id="L299">		User u = userService.findUserByUsername(username);</span>
<span class="nc" id="L300">		List&lt;Dbrule&gt; rules = ruleRepository.findByUser(u);</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">		for(Dbrule r : rules) {</span>
<span class="nc" id="L302">			ruleRepository.delete(r);</span>
<span class="nc" id="L303">		}</span>
<span class="nc" id="L304">	}</span>
	@Override
	public List&lt;Dbentity&gt; getEntities(String username) {
<span class="nc" id="L307">		User u = userService.findUserByUsername(username);</span>
<span class="nc" id="L308">		return this.entityRepository.findByUser(u);</span>
	}

	@Override
	public void deleteAllEntities(String username) {
<span class="nc" id="L313">		User u = userService.findUserByUsername(username);</span>
<span class="nc" id="L314">		List&lt;Dbentity&gt; entities = entityRepository.findByUser(u);</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">		for(Dbentity e : entities)</span>
<span class="nc" id="L316">			entityRepository.delete(e);</span>
<span class="nc" id="L317">	}</span>

	@Override
	public Set&lt;Trigger&gt; getDefinedTriggersByType(String type, String username) throws OWLOntologyCreationException, InterruptedException {
<span class="nc" id="L321">		List&lt;Rule&gt; rules = this.getRulesByType(type, username);</span>
<span class="nc" id="L322">		Set&lt;Trigger&gt; triggers = new HashSet&lt;Trigger&gt;();</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">		for(Rule rule : rules)</span>
<span class="nc" id="L324">			triggers.add(rule.getTrigger());</span>
<span class="nc" id="L325">		return triggers;</span>
	}

	@Override
	public Rule getRule(Long ruleId, String username) throws OWLOntologyCreationException, InterruptedException {
<span class="nc" id="L330">		Dbrule dbRule = ruleRepository.findById(ruleId).get();</span>
<span class="nc" id="L331">		Rule rule = new Rule();</span>
<span class="nc" id="L332">		rule.setDbId(dbRule.getId());</span>
<span class="nc" id="L333">		Trigger trigger = new Trigger();</span>
<span class="nc" id="L334">		Action action = new Action();</span>
<span class="nc" id="L335">		Dbtrigger dbTrigger = dbRule.getTriggers().iterator().next();</span>
<span class="nc" id="L336">		Dbaction dbAction = dbRule.getActions().iterator().next();</span>
		
<span class="nc" id="L338">		trigger = owlService.getTrigger(dbTrigger.getUrl(), username);</span>
<span class="nc" id="L339">		action = owlService.getAction(dbAction.getUrl(), username);</span>

<span class="nc bnc" id="L341" title="All 2 branches missed.">		for(Dbdetail db : dbTrigger.getDetails()){</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">			for(Detail d : trigger.getDetails()){</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">				if(d.getType().equals(&quot;entity&quot;))</span>
<span class="nc" id="L344">					d.setValue(dbTrigger.getEntity().getUrl());</span>
<span class="nc bnc" id="L345" title="All 6 branches missed.">				if(d.getURL() != null &amp;&amp; db.getUrl() != null &amp;&amp; d.getURL().equals(db.getUrl())){</span>
<span class="nc" id="L346">					d.setValue(db.getValue());</span>
				}
<span class="nc" id="L348">			}</span>
<span class="nc" id="L349">		}</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">		for(Dbdetail db : dbAction.getDetails()){</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">			for(Detail d : action.getDetails()){</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">				if(d.getType().equals(&quot;entity&quot;))</span>
<span class="nc" id="L353">					d.setValue(dbAction.getEntity().getUrl());</span>
<span class="nc bnc" id="L354" title="All 6 branches missed.">				else if(d.getURL() != null &amp;&amp; db.getUrl() != null &amp;&amp; d.getURL().equals(db.getUrl())){</span>
<span class="nc" id="L355">					d.setValue(db.getValue());</span>
				}
				
<span class="nc" id="L358">			}</span>
<span class="nc" id="L359">		}</span>
<span class="nc" id="L360">		rule.setAction(action);</span>
<span class="nc" id="L361">		rule.setTrigger(trigger);</span>
<span class="nc" id="L362">		return rule;</span>
	}

	@Override
	public List&lt;Rule&gt; getPossibleRules(String type, String username) throws InterruptedException, OWLOntologyCreationException {
<span class="nc" id="L367">		List&lt;Rule&gt; rules = new LinkedList&lt;Rule&gt;();</span>
		
<span class="nc" id="L369">		Collection &lt;Service&gt; triggerServices = owlService.getTriggerServices();</span>
<span class="nc" id="L370">		Collection &lt;Service&gt; actionServices = owlService.getTriggerServices();</span>
		
<span class="nc" id="L372">		Collection&lt;Trigger&gt; triggers = new LinkedList&lt;Trigger&gt;();</span>
<span class="nc" id="L373">		Collection&lt;Action&gt; actions = new LinkedList&lt;Action&gt;();</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">		for(Service service : triggerServices)</span>
<span class="nc" id="L375">			triggers.addAll(owlService.getTriggers(service.getId(), username));</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">		for(Service service : actionServices)</span>
<span class="nc" id="L377">			actions.addAll(owlService.getActions(service.getId(), username));</span>
		
		
<span class="nc bnc" id="L380" title="All 2 branches missed.">		for(Trigger trigger : triggers) {</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">			for(Action action : actions) {</span>
<span class="nc" id="L382">				Rule rule = new Rule();</span>
<span class="nc" id="L383">				rule.setTrigger(trigger);</span>
<span class="nc" id="L384">				rule.setAction(action);</span>
<span class="nc" id="L385">				rules.add(rule);</span>
<span class="nc" id="L386">			}</span>
<span class="nc" id="L387">		}</span>
		
<span class="nc" id="L389">		return rules;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>